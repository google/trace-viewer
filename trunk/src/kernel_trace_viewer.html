<!DOCTYPE HTML>
<html>
<!--
Copyright (c) 2011 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->
<head i18n-values="dir:textdirection;">
<title>Interactive Timeline Tests</title>
<script src="base.js"></script>
<style>
  .view {
    overflow: hidden;
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
  }

</style>
</head>
<body>
  <div class="view">
  </div>
  <script>
  var linuxPerfData;
  var traceEventData;
  var timelineViewEl;

  function onLoad() {
    if (!document.body)
      document.addEventListener('DOMContentLoaded', onLoad);

    var dirname;
    if (window.location.search) {
      var q = {};
      window.location.search.slice(1).split('&').forEach(function(x) {
        var t = x.split('=');
        q[t[0]] = t[1];
      });
      if (q.dirname)
        dirname = q.dirname;
      else
        dirname = './cur_trace';
    } else {
      dirname = './cur_trace';
    }
    // Creating attached vs detached stress tests the canvas- and viewport-
    // setup code.
    test_utils.getAsync(dirname + '/kernel.trace', function(data) {
      linuxPerfData = data;
      reload();
    });
    test_utils.getAsync(dirname + '/chrome.json', function(data) {
      traceEventData = data;
      reload();
    });
  }
  function reload() {
    if (!linuxPerfData || !traceEventData)
      return;

    var m = new tracing.TimelineModel();
    m.importEvents(traceEventData, true, [linuxPerfData]);

    timelineViewEl = document.querySelector('.view');
    base.ui.decorate(timelineViewEl, tracing.TimelineView);
    timelineViewEl.model = m;
    timelineViewEl.tabIndex = 1;
    timelineViewEl.timeline.focusElement = timelineViewEl;
  }

  base.defineModule('kernel_trace_viewer')
      .dependsOn('timeline_view',
                 'test_utils')
      .runWhenLoaded(onLoad);

  </script>
</body>
</html>
