<!DOCTYPE HTML>
<html>
<!--
Copyright (c) 2010 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->



<!------------------------------------------------------------------------------
WARNING: This file is generated by generate_about_tracing_contents.py

         Do not edit directly.


------------------------------------------------------------------------------->



<head i18n-values="dir:textdirection;">
<style>
html, body {
  height: 100%;
}

body {
  -webkit-box-orient: vertical;
  display: -webkit-box;
  margin: 0;
  padding: 0;
}

</style>
<link rel="stylesheet" href="ui/overlay.css">
<link rel="stylesheet" href="about_tracing/tracing_controller.css">
<link rel="stylesheet" href="tracing/analysis/analysis_link.css">
<link rel="stylesheet" href="tracing/analysis/generic_object_view.css">
<link rel="stylesheet" href="tracing/analysis/analysis_results.css">
<link rel="stylesheet" href="tracing/analysis/analyze_slices.css">
<link rel="stylesheet" href="ui/drag_handle.css">
<link rel="stylesheet" href="ui/list_view.css">
<link rel="stylesheet" href="cc/layer_picker.css">
<link rel="stylesheet" href="ui/info_bar.css">
<link rel="stylesheet" href="ui/quad_view.css">
<link rel="stylesheet" href="ui/quad_stack.css">
<link rel="stylesheet" href="cc/layer_tree_quad_stack_viewer.css">
<link rel="stylesheet" href="cc/layer_viewer.css">
<link rel="stylesheet" href="cc/layer_tree_host_impl_view.css">
<link rel="stylesheet" href="cc/picture_ops_list_view.css">
<link rel="stylesheet" href="cc/picture_debugger.css">
<link rel="stylesheet" href="cc/picture_view.css">
<link rel="stylesheet" href="cc/raster_task_slice_view.css">
<link rel="stylesheet" href="tcmalloc/tcmalloc_instance_view.css">
<link rel="stylesheet" href="tcmalloc/tcmalloc_snapshot_view.css">
<link rel="stylesheet" href="tracing/record_selection_dialog.css">
<link rel="stylesheet" href="tracing/analysis/default_object_view.css">
<link rel="stylesheet" href="tracing/analysis/analysis_view.css">
<link rel="stylesheet" href="tracing/tracks/track.css">
<link rel="stylesheet" href="tracing/tracks/canvas_based_track.css">
<link rel="stylesheet" href="tracing/tracks/ruler_track.css">
<link rel="stylesheet" href="tracing/tracks/slice_track.css">
<link rel="stylesheet" href="tracing/tracks/object_instance_track.css">
<link rel="stylesheet" href="tcmalloc/heap_instance_track.css">
<link rel="stylesheet" href="tracing/tracks/counter_track.css">
<link rel="stylesheet" href="tracing/tracks/thread_track.css">
<link rel="stylesheet" href="tracing/tracks/trace_model_track.css">
<link rel="stylesheet" href="tracing/timeline_track_view.css">
<link rel="stylesheet" href="ui/filter_control.css">
<link rel="stylesheet" href="ui/regexp_selector.css">
<link rel="stylesheet" href="tracing/tracks/track_selector.css">
<link rel="stylesheet" href="tracing/timeline_view.css">
<link rel="stylesheet" href="about_tracing/profiling_view.css">

<!--
Copyright (c) 2013 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->

<template id="view-category-filter-dialog-template">
  <div class="category-filter-dialog">
    Select active categories:
    <form class="category-filter-dialog-form">
      <div class="categories">
      </div>
    </form>
  </div>
</template>
<!--
Copyright (c) 2013 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->

<template id="record-selection-dialog-template">
  <div class="record-selection-dialog">
    <form>
      <table>
        <tr>
          <td class="default-enabled-categories">
            <div>Record&nbsp;Categories</div>
            <div class="group-selectors">
              Select
              <button class="all-btn">All</button>
              <button class="none-btn">None</button>
            </div>
            <div class="categories"></div>
          </td>
          <td class="default-disabled-categories">
            <div>Disabled&nbsp;by&nbsp;Default&nbsp;Categories</div>
            <div class="group-selectors">
              Select
              <button class="all-btn">All</button>
              <button class="none-btn">None</button>
            </div>
            <div class="categories"></div>
          </td>
        </tr>
      </table>
    </form>

    <div class="options">
      <button class="record-categories">Record</button>
      <label class="continuous-tracing-label">
        Continuous tracing
        <input type="checkbox" value="continuousTracing" checked="checked"
               class="continuous-tracing-button" />
      </label>
      <label class="system-tracing-label">
        System events
        <input type="checkbox" value="systemTracing"
               class="system-tracing-button" />
      </label>
    </div>
  </div>
</template>
<!--
Copyright (c) 2013 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->

<template id="timeline-view-template">
  <div class="control">
    <div id="left-controls" class="controls"></div>
    <div class="title">^_^</div>
    <div id="right-controls" class="controls category-filter"></div>
  </div>
  <div class="container"></div>
</template>

<template id="track-selector-btn-template">
  <div class="track-selector-anchor">
    <button class="button track-selector-button track-selector-closed">
      Track Selector
    </button>
  </div>
</template>

<template id="import-errors-btn-template">
  <div class="button view-import-errors-button view-info-button">
    Import errors!
  </div>
  <div class="info-button-container import-errors-dialog">
    Errors occurred during import:
    <div class="info-button-text import-errors-dialog-text"></div>
  </div>
</template>

<template id="category-filter-btn-template">
  <div class="button view-info-button">Categories</div>
</template>

<template id="help-btn-template">
  <div class="button view-help-button">?</div>
  <div class="view-help-text"
      style="white-space: pre; font-family: monospace"></div>
</template>

<template id="metadata-btn-template">
  <div class="button view-metadata-button view-info-button">
    Metadata
  </div>
  <div class="info-button-container metadata-dialog">
    Metadata Info:
    <div class="info-button-text metadata-dialog-text"></div>
  </div>
</template>
<!DOCTYPE HTML>
<html>
<!--
Copyright (c) 2013 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->
<head>
<title>AsyncSliceGroup tests</title>
<script src="/src/base.js"></script>
<link rel="shortcut icon" href="data:image/x-icon;base64," type="image/x-icon">
</head>
<body>
  <script>
    base.require('base.unittest');
    base.require('tracing.test_utils');
    base.require('tracing.trace_model');
  </script>
  <script>
  'use strict';

  var Model = tracing.TraceModel;
  var Process = tracing.model.Process;
  var Thread = tracing.model.Thread;
  var AsyncSlice = tracing.model.AsyncSlice;
  var AsyncSliceGroup = tracing.model.AsyncSliceGroup;
  var newAsyncSlice = tracing.test_utils.newAsyncSlice;

  function testAsyncSliceGroupBounds_Empty() {
    var g = new AsyncSliceGroup();
    g.updateBounds();
    assertTrue(g.bounds.isEmpty);
  }

  function testAsyncSliceGroupBounds_Basic() {
    var p1 = new Process(1);
    var t1 = new Thread(p1, 1);
    var g = new AsyncSliceGroup();
    g.push(newAsyncSlice(0, 1, t1, t1));
    g.push(newAsyncSlice(1, 1.5, t1, t1));
    assertEquals(2, g.length);
    g.updateBounds();
    assertEquals(0, g.bounds.min);
    assertEquals(2.5, g.bounds.max);
  }

  function testAsyncSlice_toJSON() {
    var js = [
      '{',
      '  "category" : "",',
      '  "title" : "a",',
      '  "start" : 0,',
      '  "colorId" : 0,',
      '  "didNotFinish" : false,',
      '  "duration" : 1,',
      '  "startThread" : __T1_GUID__,',
      '  "endThread" : __T1_GUID__,',
      '  "subSlices" : [ {',
      '        "category" : "",',
      '        "title" : "a",',
      '        "start" : 0,',
      '        "colorId" : 0,',
      '        "didNotFinish" : false,',
      '        "duration" : 1,',
      '        "startThread" : __T1_GUID__,',
      '        "endThread" : __T1_GUID__',
      '      } ]',
      '}'].join('\n');

    var p1 = new Process(1);
    var t1 = new Thread(p1, 1);
    var s = newAsyncSlice(0, 1, t1, t1);

    // Replace __T1_GUID__ with t1's actual GUID
    js = js.replace(/__T1_GUID__/g, t1.guid);

    // Modify whitespace of "js" so that string compare with another
    // JSON.stringified version can succeed.
    js = JSON.stringify(JSON.parse(js));


    assertEquals(js, JSON.stringify(s));
  }

</script>
</body>
</html>
<!DOCTYPE HTML>
<html>
<!--
Copyright (c) 2012 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->
<head>
<title>Counter tests</title>
<script src="/src/base.js"></script>
<script>
  base.require('base.unittest');
  base.require('tracing.test_utils');
  base.require('tracing.model.counter');
</script>
<link rel="shortcut icon" href="data:image/x-icon;base64," type="image/x-icon">
</head>
<body>
<script>
  'use strict';

  var Counter = tracing.model.Counter;

  function createCounterWithTwoSeries() {
    var ctr = new Counter(null, 0, '', 'myCounter');
    ctr.seriesNames.push('a', 'b');
    ctr.seriesColors.push(0, 1);
    ctr.timestamps.push(0, 1, 2, 3);
    ctr.samples.push(5, 10, 6, 15, 5, 12, 7, 16);
    return ctr;
  }

  function testGetSampleStatisticsWithSingleSelection() {
    var ctr = createCounterWithTwoSeries();
    var ret = ctr.getSampleStatistics([0]);

    assertEquals(5, ret[0].min);
    assertEquals(5, ret[0].max);
    assertEquals(5, ret[0].avg);
    assertEquals(5, ret[0].start);
    assertEquals(5, ret[0].end);

    assertEquals(10, ret[1].min);
    assertEquals(10, ret[1].max);
    assertEquals(10, ret[1].avg);
    assertEquals(10, ret[1].start);
    assertEquals(10, ret[1].end);
  }

  function testGetSampleStatisticsWithMultipleSelections() {
    var ctr = createCounterWithTwoSeries();
    var ret = ctr.getSampleStatistics([0, 1]);

    assertEquals(5, ret[0].min);
    assertEquals(6, ret[0].max);
    assertEquals((5 + 6) / 2, ret[0].avg);
    assertEquals(5, ret[0].start);
    assertEquals(6, ret[0].end);

    assertEquals(10, ret[1].min);
    assertEquals(15, ret[1].max);
    assertEquals((10 + 15) / 2, ret[1].avg);
    assertEquals(10, ret[1].start);
    assertEquals(15, ret[1].end);
  }

  function testGetSampleStatisticsWithOutofOrderIndices() {
    var ctr = createCounterWithTwoSeries();
    var ret = ctr.getSampleStatistics([1, 0]);

    assertEquals(5, ret[0].min);
    assertEquals(6, ret[0].max);
    assertEquals((5 + 6) / 2, ret[0].avg);
    assertEquals(5, ret[0].start);
    assertEquals(6, ret[0].end);

    assertEquals(10, ret[1].min);
    assertEquals(15, ret[1].max);
    assertEquals((10 + 15) / 2, ret[1].avg);
    assertEquals(10, ret[1].start);
    assertEquals(15, ret[1].end);
  }

  function testGetSampleStatisticsWithAllSelections() {
    var ctr = createCounterWithTwoSeries();
    var ret = ctr.getSampleStatistics([1, 0, 2, 3]);

    assertEquals(5, ret[0].min);
    assertEquals(7, ret[0].max);
    assertEquals((5 + 6 + 5 + 7) / 4, ret[0].avg);
    assertEquals(5, ret[0].start);
    assertEquals(7, ret[0].end);

    assertEquals(10, ret[1].min);
    assertEquals(16, ret[1].max);
    assertEquals((10 + 15 + 12 + 16) / 4, ret[1].avg);
    assertEquals(10, ret[1].start);
    assertEquals(16, ret[1].end);
  }

</script>
</body>
</html>
<!DOCTYPE HTML>
<html>
<!--
Copyright (c) 2012 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->
<head>
<title>Cpu tests</title>
<script src="/src/base.js"></script>
<script>
  base.require('base.unittest');
  base.require('tracing.test_utils');
  base.require('tracing.model.cpu');
</script>
<link rel="shortcut icon" href="data:image/x-icon;base64," type="image/x-icon">
</head>
<body>
<script>
  'use strict';

  var Cpu = tracing.model.Cpu;
  var Slice = tracing.model.Slice;

  function testCpuBounds_Empty() {
    var cpu = new Cpu(undefined, 1);
    cpu.updateBounds();
    assertEquals(undefined, cpu.bounds.min);
    assertEquals(undefined, cpu.bounds.max);
  }

  function testCpuBounds_OneSlice() {
    var cpu = new Cpu(undefined, 1);
    cpu.slices.push(tracing.test_utils.newSlice(1, 3));
    cpu.updateBounds();
    assertEquals(1, cpu.bounds.min);
    assertEquals(4, cpu.bounds.max);
  }

  function testGetOrCreateCounter() {
    var cpu = new Cpu(undefined, 1);
    var ctrBar = cpu.getOrCreateCounter('foo', 'bar');
    var ctrBar2 = cpu.getOrCreateCounter('foo', 'bar');
    assertEquals(ctrBar2, ctrBar);
  }

  function testShiftTimestampsForward() {
    var cpu = new Cpu(undefined, 1);
    var ctr = cpu.getOrCreateCounter('foo', 'bar');
    cpu.slices.push(tracing.test_utils.newSlice(1, 3));
    var shiftCount = 0;
    ctr.shiftTimestampsForward = function(ts) {
      if (ts == 0.32)
        shiftCount++;
    };
    cpu.slices.push(tracing.test_utils.newSlice(1, 3));
    cpu.shiftTimestampsForward(0.32);
    assertEquals(shiftCount, 1);
    assertEquals(1.32, cpu.slices[0].start);
  }
</script>
</body>
</html>
<!DOCTYPE HTML>
<html>
<!--
Copyright (c) 2013 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->
<head>
<title>ObjectCollection tests</title>
<script src="/src/base.js"></script>
<script>
  base.require('base.unittest');
  base.require('tracing.test_utils');
  base.require('tracing.model.object_collection');
</script>
<link rel="shortcut icon" href="data:image/x-icon;base64," type="image/x-icon">
</head>
<body>
<script>
  'use strict';

  // Create a mock object instance for the testObjectInstanceSubtype test.
  function TestObjectInstance(parent, id, category, name, creationTs) {
    tracing.model.ObjectInstance.call(
      this, parent, id, category, name, creationTs);
  }
  TestObjectInstance.prototype = {
    __proto__: tracing.model.ObjectInstance.prototype
  };

  function testObjectInstanceSubtype() {
    // Register that TestObjects are bound to TestObjectInstance.
    tracing.model.ObjectInstance.register('TestObject', TestObjectInstance);
    try {
      var collection = new tracing.model.ObjectCollection({ });
      collection.idWasCreated(
        '0x1000', 'cc', 'Frame', 10);
      collection.idWasDeleted(
        '0x1000', 'cc', 'Frame', 15);
      collection.idWasCreated(
        '0x1000', 'skia', 'TestObject', 20);
      collection.idWasDeleted(
        '0x1000', 'skia', 'TestObject', 25);

      var testFrame = collection.getObjectInstanceAt('0x1000', 10);
      assertTrue(testFrame instanceof tracing.model.ObjectInstance);
      assertFalse(testFrame instanceof TestObjectInstance);

      var testObject = collection.getObjectInstanceAt('0x1000', 20);
      assertTrue(testObject instanceof tracing.model.ObjectInstance);
      assertTrue(testObject instanceof TestObjectInstance);
    } finally {
      tracing.model.ObjectInstance.unregister('TestObject');
    }
  }

  function testTwoSnapshots() {
    var collection = new tracing.model.ObjectCollection({});
    collection.idWasCreated(
      '0x1000', 'cat', 'Frame', 10);
    collection.addSnapshot(
      '0x1000', 'cat', 'Frame', 10, {foo: 1});
    collection.addSnapshot(
      '0x1000', 'cat', 'Frame', 20, {foo: 2});

    collection.updateBounds();
    assertEquals(10, collection.bounds.min);
    assertEquals(20, collection.bounds.max);

    var s0 = collection.getSnapshotAt('0x1000', 1);
    assertUndefined(s0);

    var s1 = collection.getSnapshotAt('0x1000', 10);
    assertEquals(s1.args.foo, 1);

    var s2 = collection.getSnapshotAt('0x1000', 15);
    assertEquals(s2.args.foo, 1);
    assertEquals(s1, s2);

    var s3 = collection.getSnapshotAt('0x1000', 20);
    assertEquals(s3.args.foo, 2);
    assertEquals(s1.object, s3.object);

    var s4 = collection.getSnapshotAt('0x1000', 25);
    assertEquals(s4, s3);
  }

  function testTwoObjectsSharingOneID() {
    var collection = new tracing.model.ObjectCollection({});
    collection.idWasCreated(
      '0x1000', 'cc', 'Frame', 10);
    collection.idWasDeleted(
      '0x1000', 'cc', 'Frame', 15);
    collection.idWasCreated(
      '0x1000', 'skia', 'Picture', 20);
    collection.idWasDeleted(
      '0x1000', 'skia', 'Picture', 25);

    var frame = collection.getObjectInstanceAt('0x1000', 10);
    assertEquals('cc', frame.category);
    assertEquals('Frame', frame.name);

    var picture = collection.getObjectInstanceAt('0x1000', 20);
    assertEquals('skia', picture.category);
    assertEquals('Picture', picture.name);

    var typeNames = base.dictionaryKeys(collection.getAllInstancesByTypeName());
    typeNames.sort();
    assertArrayEquals(
        ['Frame', 'Picture'],
        typeNames);
    assertArrayEquals(
        [frame],
        collection.getAllInstancesByTypeName()['Frame']);
    assertArrayEquals(
        [picture],
        collection.getAllInstancesByTypeName()['Picture']);
  }

  function testCreateSnapDelete() {
    var collection = new tracing.model.ObjectCollection({});
    collection.idWasCreated(
      '0x1000', 'cat', 'Frame', 10);
    collection.addSnapshot(
      '0x1000', 'cat', 'Frame', 10, {foo: 1});
    collection.idWasDeleted(
      '0x1000', 'cat', 'Frame', 15);

    collection.updateBounds();
    assertEquals(10, collection.bounds.min);
    assertEquals(15, collection.bounds.max);

    var s10 = collection.getSnapshotAt('0x1000', 10);
    var i10 = s10.objectInstance;
    assertEquals(10, i10.creationTs);
    assertEquals(15, i10.deletionTs);
  }

  function testBoundsOnUndeletedObject() {
    var collection = new tracing.model.ObjectCollection({});
    collection.idWasCreated(
      '0x1000', 'cat', 'Frame', 10);
    collection.addSnapshot(
      '0x1000', 'cat', 'Frame', 15, {foo: 1});

    collection.updateBounds();
    assertEquals(collection.bounds.min, 10);
    assertEquals(collection.bounds.max, 15);
  }

  function testAutoDelete() {
    var collection = new tracing.model.ObjectCollection({});
    collection.idWasCreated(
      '0x1000', 'cat', 'Frame', 10);
    collection.addSnapshot(
      '0x1000', 'cat', 'Frame', 10, {foo: 1});
    collection.autoDeleteObjects(15);

    var s10 = collection.getSnapshotAt('0x1000', 10);
    var i10 = s10.objectInstance;
    assertEquals(i10.deletionTs, 15);
  }

</script>
</body>
</html>
<!DOCTYPE HTML>
<html>
<!--
Copyright (c) 2013 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->
<head>
<title>Object instance tests</title>
<script src="/src/base.js"></script>
<script>
  base.require('base.unittest');
  base.require('tracing.test_utils');
  base.require('tracing.model.object_instance');
</script>
<link rel="shortcut icon" href="data:image/x-icon;base64," type="image/x-icon">
</head>
<body>
<script>
  'use strict';

  function testGetSnapshotAtWithImplicitCreation() {
    var instance = new tracing.model.ObjectInstance(
        {}, '0x1000', 'cat', 'n', 10);
    var s10 = instance.addSnapshot(10, 'a');
    instance.addSnapshot(40, 'b');
    instance.wasDeleted(60);

    var s1 = instance.getSnapshotAt(1);
    assertEquals(s10, s1);

    var s10 = instance.getSnapshotAt(10);
    assertEquals('a', s10.args);
    assertEquals(s10, instance.getSnapshotAt(15));

    var s40 = instance.getSnapshotAt(40);
    assertEquals('b', s40.args);
    assertEquals(s40, instance.getSnapshotAt(50));
    assertEquals(s40, instance.getSnapshotAt(59.9));
  }

  function testGetSnapshotAtWithExplicitCreation() {
    var instance = new tracing.model.ObjectInstance(
        {}, '0x1000', 'cat', 'n', 10);
    instance.creationTsWasExplicit = true;
    instance.addSnapshot(10, 'a');
    instance.wasDeleted(60);

    assertThrows(function() {
      instance.getSnapshotAt(1);
    });

    var s10 = instance.getSnapshotAt(10);
    assertEquals('a', s10.args);
    assertEquals(s10, instance.getSnapshotAt(15));
  }

  function testGetSnapshotBeforeFirstSnapshot() {
    var instance = new tracing.model.ObjectInstance(
        {}, '0x1000', 'cat', 'n', 10);
    var s15 = instance.addSnapshot(15, 'a');
    instance.wasDeleted(40);

    assertEquals(s15, instance.getSnapshotAt(10));
  }

  function testGetSnapshotAfterLastSnapshot() {
    var instance = new tracing.model.ObjectInstance(
        {}, '0x1000', 'cat', 'n', 10);
    var s15 = instance.addSnapshot(15, 'a');
    instance.wasDeleted(40);

    assertEquals(s15, instance.getSnapshotAt(20));
  }

</script>
</body>
</html>
<!DOCTYPE HTML>
<html>
<!--
Copyright (c) 2013 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->
<script src="/src/base.js"></script>
</head>
<body>
<script>
  base.require('base.unittest');
  base.require('tracing.model.object_instance');
  base.require('tracing.model.object_snapshot');
</script>
<script>
  'use strict';

  function testSnapshotTypeRegistry() {
    function MySnapshot() {
      tracing.model.ObjectSnapshot.apply(this, arguments);
      this.myFoo = this.args.foo;
    }
    MySnapshot.prototype = {
      __proto__: tracing.model.ObjectSnapshot.prototype
    };

    var instance = new tracing.model.ObjectInstance(
      {}, '0x1000', 'cat', 'MySnapshot', 10);
    try {
      tracing.model.ObjectSnapshot.register('MySnapshot', MySnapshot);
      var snapshot = instance.addSnapshot(15, {foo: 'bar'});
      assertTrue(snapshot instanceof MySnapshot);
      assertEquals('bar', snapshot.myFoo);
    } finally {
      tracing.model.ObjectSnapshot.unregister('MySnapshot');
    }
  }

</script>
</body>
</html>
<!DOCTYPE HTML>
<html>
<!--
Copyright (c) 2012 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->
<head>
<title>Process tests</title>
<script src="/src/base.js"></script>
<script>
  base.require('base.unittest');
  base.require('tracing.test_utils');
  base.require('tracing.model.process');
</script>
<link rel="shortcut icon" href="data:image/x-icon;base64," type="image/x-icon">
</head>
<body>
<script>
  'use strict';

  var Process = tracing.model.Process;

  function testGetOrCreateCounter() {
    var process = new Process(7);
    var ctrBar = process.getOrCreateCounter('foo', 'bar');
    var ctrBar2 = process.getOrCreateCounter('foo', 'bar');
    assertEquals(ctrBar2, ctrBar);
  }

  function testShiftTimestampsForward() {
    var process = new Process(7);
    var ctr = process.getOrCreateCounter('foo', 'bar');
    var thread = process.getOrCreateThread(1);

    var shiftCount = 0;
    thread.shiftTimestampsForward = function(ts) {
      if (ts == 0.32)
        shiftCount++;
    };
    ctr.shiftTimestampsForward = function(ts) {
      if (ts == 0.32)
        shiftCount++;
    };
    process.shiftTimestampsForward(0.32);
    assertEquals(2, shiftCount);
  }

</script>
</body>
</html>
<!DOCTYPE HTML>
<html>
<!--
Copyright (c) 2012 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->
<head>
<title>SliceGroup tests</title>
<script src="/src/base.js"></script>
<script>
  base.require('base.unittest');
  base.require('tracing.test_utils');
  base.require('tracing.model.slice_group');
</script>
<link rel="shortcut icon" href="data:image/x-icon;base64," type="image/x-icon">
</head>
<body>
<script>
  'use strict';

  var Slice = tracing.model.Slice;
  var SliceGroup = tracing.model.SliceGroup;
  var newSlice = tracing.test_utils.newSlice;
  var newSliceNamed = tracing.test_utils.newSliceNamed;

  function testBasicBeginEnd() {
    var group = new SliceGroup();
    assertEquals(group.openSliceCount, 0);
    var sliceA = group.beginSlice('', 'a', 1, {a: 1});
    assertEquals(1, group.openSliceCount);
    assertEquals('a', sliceA.title);
    assertEquals(1, sliceA.start);
    assertEquals(1, sliceA.args.a);

    var sliceB = group.endSlice(3);
    assertEquals(sliceA, sliceB);
    assertEquals(2, sliceB.duration);
  }

  function testNestedBeginEnd() {
    var group = new SliceGroup();
    assertEquals(group.openSliceCount, 0);
    group.beginSlice('', 'a', 1);
    group.beginSlice('', 'b', 2);
    group.endSlice(2.5);
    group.endSlice(3);

    assertEquals(2, group.slices.length);
    assertEquals('b', group.slices[0].title);
    assertEquals(0.5, group.slices[0].duration);

    assertEquals('a', group.slices[1].title);
    assertEquals(2, group.slices[1].duration);
  }

  function testBasicMerge() {
    var a = new SliceGroup();
    var b = new SliceGroup();
    a.beginSlice('', 'one', 1);
    a.endSlice(2);
    b.beginSlice('', 'two', 3);
    b.endSlice(5);

    var m = SliceGroup.merge(a, b);
    assertEquals(2, m.slices.length);

    assertEquals('one', m.slices[0].title);
    assertEquals(1, m.slices[0].start);
    assertEquals(1, m.slices[0].duration);

    assertEquals('two', m.slices[1].title);
    assertEquals(3, m.slices[1].start);
    assertEquals(2, m.slices[1].duration);
  }

  function testNestedMerge() {
    var a = new SliceGroup();
    var b = new SliceGroup();
    a.beginSlice('', 'one', 1);
    a.endSlice(4);
    b.beginSlice('', 'two', 2);
    b.endSlice(3);

    var m = SliceGroup.merge(a, b);
    assertEquals(2, m.slices.length);

    assertEquals('two', m.slices[0].title);
    assertEquals(2, m.slices[0].start);
    assertEquals(1, m.slices[0].duration);

    assertEquals('one', m.slices[1].title);
    assertEquals(1, m.slices[1].start);
    assertEquals(3, m.slices[1].duration);
  }

  function testStartSplitMerge() {
    var a = new SliceGroup();
    var b = new SliceGroup();
    a.beginSlice('', 'one', 2);
    a.endSlice(4);
    b.beginSlice('', 'two', 1);
    b.endSlice(3);

    var m = SliceGroup.merge(a, b);
    assertEquals(3, m.slices.length);

    assertEquals('two', m.slices[0].title);
    assertEquals(1, m.slices[0].start);
    assertEquals(1, m.slices[0].duration);

    assertEquals('two (cont.)', m.slices[1].title);
    assertEquals(2, m.slices[1].start);
    assertEquals(1, m.slices[1].duration);

    assertEquals('one', m.slices[2].title);
    assertEquals(2, m.slices[2].start);
    assertEquals(2, m.slices[2].duration);
  }

  function testStartSplitTwoMerge() {
    var a = new SliceGroup();
    var b = new SliceGroup();
    a.beginSlice('', 'one', 3);
    a.endSlice(6);
    b.beginSlice('', 'two', 1);
    b.beginSlice('', 'three', 2);
    b.endSlice(4);
    b.endSlice(5);

    var m = SliceGroup.merge(a, b);
    assertEquals(5, m.slices.length);

    assertEquals('three', m.slices[0].title);
    assertEquals(2, m.slices[0].start);
    assertEquals(1, m.slices[0].duration);

    assertEquals('two', m.slices[1].title);
    assertEquals(1, m.slices[1].start);
    assertEquals(2, m.slices[1].duration);

    assertEquals('three (cont.)', m.slices[2].title);
    assertEquals(3, m.slices[2].start);
    assertEquals(1, m.slices[2].duration);

    assertEquals('two (cont.)', m.slices[3].title);
    assertEquals(3, m.slices[3].start);
    assertEquals(2, m.slices[3].duration);

    assertEquals('one', m.slices[4].title);
    assertEquals(3, m.slices[4].start);
    assertEquals(3, m.slices[4].duration);
  }

  function testStartSplitTwiceMerge() {
    var a = new SliceGroup();
    var b = new SliceGroup();
    a.beginSlice('', 'one', 2);
    a.beginSlice('', 'two', 3);
    a.endSlice(5);
    a.endSlice(6);
    b.beginSlice('', 'three', 1);
    b.endSlice(4);

    var m = SliceGroup.merge(a, b);
    assertEquals(5, m.slices.length);

    assertEquals('three', m.slices[0].title);
    assertEquals(1, m.slices[0].start);
    assertEquals(1, m.slices[0].duration);

    assertEquals('three (cont.)', m.slices[1].title);
    assertEquals(2, m.slices[1].start);
    assertEquals(1, m.slices[1].duration);

    assertEquals('three (cont.)', m.slices[2].title);
    assertEquals(3, m.slices[2].start);
    assertEquals(1, m.slices[2].duration);

    assertEquals('two', m.slices[3].title);
    assertEquals(3, m.slices[3].start);
    assertEquals(2, m.slices[3].duration);

    assertEquals('one', m.slices[4].title);
    assertEquals(2, m.slices[4].start);
    assertEquals(4, m.slices[4].duration);
  }

  function testEndSplitMerge() {
    var a = new SliceGroup();
    var b = new SliceGroup();
    a.beginSlice('', 'one', 1);
    a.endSlice(3);
    b.beginSlice('', 'two', 2);
    b.endSlice(4);

    var m = SliceGroup.merge(a, b);
    assertEquals(3, m.slices.length);

    assertEquals('two', m.slices[0].title);
    assertEquals(2, m.slices[0].start);
    assertEquals(1, m.slices[0].duration);

    assertEquals('one', m.slices[1].title);
    assertEquals(1, m.slices[1].start);
    assertEquals(2, m.slices[1].duration);

    assertEquals('two (cont.)', m.slices[2].title);
    assertEquals(3, m.slices[2].start);
    assertEquals(1, m.slices[2].duration);
  }

  function testEndSplitTwoMerge() {
    var a = new SliceGroup();
    var b = new SliceGroup();
    a.beginSlice('', 'one', 1);
    a.endSlice(4);
    b.beginSlice('', 'two', 2);
    b.beginSlice('', 'three', 3);
    b.endSlice(5);
    b.endSlice(6);

    var m = SliceGroup.merge(a, b);
    assertEquals(5, m.slices.length);

    assertEquals('three', m.slices[0].title);
    assertEquals(3, m.slices[0].start);
    assertEquals(1, m.slices[0].duration);

    assertEquals('two', m.slices[1].title);
    assertEquals(2, m.slices[1].start);
    assertEquals(2, m.slices[1].duration);

    assertEquals('one', m.slices[2].title);
    assertEquals(1, m.slices[2].start);
    assertEquals(3, m.slices[2].duration);

    assertEquals('three (cont.)', m.slices[3].title);
    assertEquals(4, m.slices[3].start);
    assertEquals(1, m.slices[3].duration);

    assertEquals('two (cont.)', m.slices[4].title);
    assertEquals(4, m.slices[4].start);
    assertEquals(2, m.slices[4].duration);
  }

  function testEndSplitTwiceMerge() {
    var a = new SliceGroup();
    var b = new SliceGroup();
    a.beginSlice('', 'one', 1);
    a.beginSlice('', 'two', 2);
    a.endSlice(4);
    a.endSlice(5);
    b.beginSlice('', 'three', 3);
    b.endSlice(6);

    var m = SliceGroup.merge(a, b);
    assertEquals(5, m.slices.length);

    assertEquals('three', m.slices[0].title);
    assertEquals(3, m.slices[0].start);
    assertEquals(1, m.slices[0].duration);

    assertEquals('two', m.slices[1].title);
    assertEquals(2, m.slices[1].start);
    assertEquals(2, m.slices[1].duration);

    assertEquals('three (cont.)', m.slices[2].title);
    assertEquals(4, m.slices[2].start);
    assertEquals(1, m.slices[2].duration);

    assertEquals('one', m.slices[3].title);
    assertEquals(1, m.slices[3].start);
    assertEquals(4, m.slices[3].duration);

    assertEquals('three (cont.)', m.slices[4].title);
    assertEquals(5, m.slices[4].start);
    assertEquals(1, m.slices[4].duration);
  }

  //
  // Input:
  // A:  |    one     |       |     two     |
  //
  // B:       |         three         |
  //
  // Output:
  //     |    one     | three |     two     |
  //          | three |       | three |
  //
  function testSplitTwiceMerge() {
    var a = new SliceGroup();
    var b = new SliceGroup();
    a.beginSlice('', 'one', 1);
    a.endSlice(3);
    a.beginSlice('', 'two', 4);
    a.endSlice(6);
    b.beginSlice('', 'three', 2);
    b.endSlice(5);

    var m = SliceGroup.merge(a, b);
    assertEquals(5, m.slices.length);

    assertEquals('three', m.slices[0].title);
    assertEquals(2, m.slices[0].start);
    assertEquals(1, m.slices[0].duration);

    assertEquals('one', m.slices[1].title);
    assertEquals(1, m.slices[1].start);
    assertEquals(2, m.slices[1].duration);

    assertEquals('three (cont.)', m.slices[2].title);
    assertEquals(3, m.slices[2].start);
    assertEquals(1, m.slices[2].duration);

    assertEquals('three (cont.)', m.slices[3].title);
    assertEquals(4, m.slices[3].start);
    assertEquals(1, m.slices[3].duration);

    assertEquals('two', m.slices[4].title);
    assertEquals(4, m.slices[4].start);
    assertEquals(2, m.slices[4].duration);
  }

  function testBounds() {
    var group = new SliceGroup();
    group.updateBounds();
    assertEquals(group.bounds.min, undefined);
    assertEquals(group.bounds.max, undefined);

    group.pushSlice(newSlice(1, 3));
    group.pushSlice(newSlice(7, 2));
    group.updateBounds();
    assertEquals(1, group.bounds.min);
    assertEquals(9, group.bounds.max);
  }

  function testBoundsWithPartial() {
    var group = new SliceGroup();
    group.beginSlice('', 'a', 7);
    group.updateBounds();
    assertEquals(7, group.bounds.min);
    assertEquals(7, group.bounds.max);
  }

  function testBoundsWithTwoPartials() {
    var group = new SliceGroup();
    group.beginSlice('', 'a', 0);
    group.beginSlice('', 'a', 1);
    group.updateBounds();
    assertEquals(0, group.bounds.min);
    assertEquals(1, group.bounds.max);
  }

  function testBoundsWithBothPartialAndRegular() {
    var group = new SliceGroup();
    group.updateBounds();
    assertEquals(undefined, group.bounds.min);
    assertEquals(undefined, group.bounds.max);

    group.pushSlice(newSlice(1, 3));
    group.beginSlice('', 'a', 7);
    group.updateBounds();
    assertEquals(1, group.bounds.min);
    assertEquals(7, group.bounds.max);
  }

  function testAutocloserBasic() {
    var group = new SliceGroup();
    assertEquals(group.openSliceCount, 0);

    group.pushSlice(newSliceNamed('a', 1, 0.5));

    group.beginSlice('', 'b', 2);
    group.beginSlice('', 'c', 2.5);
    group.endSlice(3);

    group.autoCloseOpenSlices();
    group.updateBounds();

    assertEquals(1, group.bounds.min);
    assertEquals(3, group.bounds.max);
    assertEquals(3, group.slices.length);
    assertEquals('a', group.slices[0].title);
    assertEquals('c', group.slices[1].title);
    assertEquals('b', group.slices[2].title);
    assertTrue(group.slices[2].didNotFinish);
    assertEquals(1, group.slices[2].duration);
  }

  function testAutocloserWithSubTasks() {
    var group = new SliceGroup();
    assertEquals(group.openSliceCount, 0);

    group.beginSlice('', 'a', 1);
    group.beginSlice('', 'b1', 2);
    group.endSlice(3);
    group.beginSlice('', 'b2', 3);

    group.autoCloseOpenSlices();
    assertEquals(3, group.slices.length);
    assertEquals('b1', group.slices[0].title);

    assertEquals('b2', group.slices[1].title);
    assertTrue(group.slices[1].didNotFinish);
    assertEquals(0, group.slices[1].duration);

    assertEquals('a', group.slices[2].title);
    assertTrue(group.slices[2].didNotFinish);
    assertEquals(2, group.slices[2].duration);
  }

  // TODO: test cretion of subSlices
</script>
</body>
</html>
<!DOCTYPE HTML>
<html>
<!--
Copyright (c) 2012 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->
<head>
<title>Thread tests</title>
<script src="/src/base.js"></script>
<script>
  base.require('base.unittest');
  base.require('tracing.test_utils');
  base.require('tracing.trace_model');
</script>
<link rel="shortcut icon" href="data:image/x-icon;base64," type="image/x-icon">
</head>
<body>
<script>
  'use strict';

  var ThreadSlice = tracing.model.ThreadSlice;
  var Process = tracing.model.Process;
  var Thread = tracing.model.Thread;
  var newSliceNamed = tracing.test_utils.newSliceNamed;
  var newAsyncSlice = tracing.test_utils.newAsyncSlice;
  var newAsyncSliceNamed = tracing.test_utils.newAsyncSliceNamed;

  function testThreadBounds_Empty() {
    var t = new Thread(new Process(7), 1);
    t.updateBounds();
    assertEquals(undefined, t.bounds.min);
    assertEquals(undefined, t.bounds.max);
  }

  function testThreadBounds_SubRow() {
    var t = new Thread(new Process(7), 1);
    t.pushSlice(new ThreadSlice('', 'a', 0, 1, {}, 3));
    t.updateBounds();
    assertEquals(1, t.bounds.min);
    assertEquals(4, t.bounds.max);
  }

  function testThreadBounds_AsyncSliceGroup() {
    var t = new Thread(new Process(7), 1);
    t.pushSlice(new ThreadSlice('', 'a', 0, 1, {}, 3));
    t.asyncSlices.push(newAsyncSlice(0.1, 5, t, t));
    t.updateBounds();
    assertEquals(0.1, t.bounds.min);
    assertEquals(5.1, t.bounds.max);
  }

  function testThreadBounds_Cpu() {
    var t = new Thread(new Process(7), 1);
    t.cpuSlices = [newSliceNamed('x', 0, 1)];
    t.updateBounds();
    assertEquals(0, t.bounds.min);
    assertEquals(1, t.bounds.max);
  }

  function testShiftTimestampsForwardWithCpu() {
    var t = new Thread(new Process(7), 1);
    t.pushSlice(new ThreadSlice('', 'a', 0, 0, {}, 3));
    t.asyncSlices.push(newAsyncSlice(0, 5, t, t));
    t.cpuSlices = [newSliceNamed('x', 0, 1)];

    var shiftCount = 0;
    t.asyncSlices.shiftTimestampsForward = function(ts) {
      if (ts == 0.32)
        shiftCount++;
    };

    t.shiftTimestampsForward(0.32);

    assertEquals(1, shiftCount);
    assertEquals(0.32, t.slices[0].start);
    assertEquals(0.32, t.cpuSlices[0].start);
  }

  function testShiftTimestampsForwardWithoutCpu() {
    var t = new Thread(new Process(7), 1);
    t.pushSlice(new ThreadSlice('', 'a', 0, 0, {}, 3));
    t.asyncSlices.push(newAsyncSlice(0, 5, t, t));

    var shiftCount = 0;
    t.asyncSlices.shiftTimestampsForward = function(ts) {
      if (ts == 0.32)
        shiftCount++;
    };

    t.shiftTimestampsForward(0.32);

    assertEquals(1, shiftCount);
    assertEquals(0.32, t.slices[0].start);
  }
</script>
</body>
</html>
<!DOCTYPE HTML>
<html>
<!--
Copyright (c) 2013 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->
<head>
<title>TimeToObjectInstanceMap tests</title>
<script src="/src/base.js"></script>
<script>
  base.require('base.unittest');
  base.require('tracing.test_utils');
  base.require('tracing.model.time_to_object_instance_map');
  base.require('tracing.model.object_instance');
</script>
<link rel="shortcut icon" href="data:image/x-icon;base64," type="image/x-icon">
</head>
<body>
<script>
  'use strict';

  function createObjectInstance(parent, id, category, name, creationTs) {
    return new tracing.model.ObjectInstance(
        parent, id, category, name, creationTs);
  }

  function testTimeToObjectInstanceMap() {
    var m = new tracing.model.TimeToObjectInstanceMap(createObjectInstance,
                                                      {}, 7);
    m.addSnapshot('cat', 'name', 10, 'a1');
    m.addSnapshot('cat', 'name', 20, 'a2');
    m.idWasDeleted('cat', 'name', 30);
    m.addSnapshot('cat', 'name', 40, 'b');

    assertEquals(2, m.instances.length);

    var i0 = m.getInstanceAt(0);
    var i10 = m.getInstanceAt(10);
    assertEquals(i10, i0);

    assertNotUndefined(i10);
    assertEquals(2, i10.snapshots.length);
    assertEquals('a1', i10.snapshots[0].args);
    assertEquals('a2', i10.snapshots[1].args);

    assertEquals(30, i10.deletionTs);

    var i15 = m.getInstanceAt(15);
    assertEquals(i10, i15);

    var i20 = m.getInstanceAt(20);
    assertEquals(i10, i20);

    var i30 = m.getInstanceAt(30);
    assertUndefined(i30);

    var i35 = m.getInstanceAt(35);
    assertUndefined(i35);

    var i40 = m.getInstanceAt(40);
    assertNotUndefined(i40);
    assertNotEquals(i10, i40);
    assertEquals(1, i40.snapshots.length);
    assertEquals(40, i40.creationTs);
    assertEquals(Number.MAX_VALUE, i40.deletionTs);

    var i41 = m.getInstanceAt(41);
    assertEquals(i41, i40);
  }

  function testTimeToObjectInstanceMapsBoundsLogic() {
    var m = new tracing.model.TimeToObjectInstanceMap(createObjectInstance,
                                                      {}, 7);
    m.addSnapshot('cat', 'name', 10, 'a1');
    m.addSnapshot('cat', 'name', 20, 'a2');
    m.idWasDeleted('cat', 'name', 30);
    m.addSnapshot('cat', 'name', 40, 'b');
    m.addSnapshot('cat', 'name', 41, 'b');

    m.instances.forEach(function(i) { i.updateBounds(); });

    var iA = m.getInstanceAt(10);
    assertEquals(10, iA.bounds.min);
    assertEquals(30, iA.bounds.max);

    var iB = m.getInstanceAt(40);
    assertEquals(40, iB.bounds.min);
    assertEquals(41, iB.bounds.max);
  }

  function testEarlySnapshot() {
    var m = new tracing.model.TimeToObjectInstanceMap(createObjectInstance,
                                                      {}, 7);
    var i10 = m.idWasCreated('cat', 'name', 10, 'a1');
    m.idWasDeleted('cat', 'name', 20);

    assertThrows(function() {
      m.addSnapshot('cat', 'name', 5, 'a1');
    });
    assertEquals(10, i10.creationTs);
    assertEquals(20, i10.deletionTs);
  }

  function testEarlySnapshotWithImplicitCreate() {
    var m = new tracing.model.TimeToObjectInstanceMap(createObjectInstance,
                                                      {}, 7);
    var i10 = m.idWasDeleted('cat', 'name', 20);
    m.addSnapshot('cat', 'name', 5, 'a1');
    assertEquals(5, i10.creationTs);
    assertEquals(20, i10.deletionTs);
  }

  function testGetInstanceBeforeCreationImplicitCreate() {
    var m = new tracing.model.TimeToObjectInstanceMap(createObjectInstance,
                                                      {}, 7);
    var i10 = m.idWasCreated('cat', 'name', 10, 'a1');
    m.idWasDeleted('cat', 'name', 20);
    assertEquals(undefined, m.getInstanceAt(5));
  }

  function testGetInstanceBeforeCreationImplicitCreate() {
    var m = new tracing.model.TimeToObjectInstanceMap(createObjectInstance,
                                                      {}, 7);
    var s5 = m.addSnapshot('cat', 'name', 5, 'a1');
    var i10 = m.idWasDeleted('cat', 'name', 20);
    assertEquals(i10, m.getInstanceAt(5));
  }

  function testSnapshotAfterDeletion() {
    var m = new tracing.model.TimeToObjectInstanceMap(createObjectInstance,
                                                      {}, 7);
    var i10 = m.idWasCreated('cat', 'name', 10, 'a1');
    m.idWasDeleted('cat', 'name', 20);

    var s25 = m.addSnapshot('cat', 'name', 25, 'a1');
    var i25 = s25.objectInstance;

    assertEquals(10, i10.creationTs);
    assertEquals(20, i10.deletionTs);
    assertNotEquals(i10, i25);
    assertEquals(25, i25.creationTs);
    assertEquals(Number.MAX_VALUE, i25.deletionTs);
  }

</script>
</body>
</html>

<script src="chrome://tracing/tracing.js"></script>
</head>
<body>
  <div id="profiling-view"></div>
</body>
</html>
