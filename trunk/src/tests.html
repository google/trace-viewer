<!DOCTYPE html>
<html>
<!--
Copyright (c) 2012 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->
<head>
<title>All Tracing Tests</title>
<script>
  tests = [
    'unittest_test.html',
    'overlay_test.html',
    'timeline_model_test.html',
    'timeline_track_test.html',
    'linux_perf_importer_test.html',
    'trace_event_importer_test.html',
    'profiling_view_test.html',
    'timeline_test.html',
    'timeline_view_test.html',
    'timeline_analysis_test.html',
  ];
</script>
<script src="base.js"></script>
<script src="unittest.js"></script>
</head>
<body>
  <script>
  function runTest(runner, testCaseEl, test) {
    testCaseEl.status = 'RUNNING'

    var iframe = document.createElement('iframe');
    iframe.src = test;
    iframe.style.position = 'fixed';
    iframe.style.visibility = 'hidden';
    document.body.appendChild(iframe);
    function checkForDone() {
      if (!iframe.contentWindow) {
        setTimeout(checkForDone, 100);
        return;
      }

      if (!iframe.contentWindow.G_testRunner) {
        setTimeout(checkForDone, 100);
        return;
      }

      var runner = iframe.contentWindow.G_testRunner;
      if (!runner.done) {
        setTimeout(checkForDone, 100);
        return;
      }

      var stats = runner.computeResultStats();
      if (!stats.numTestsWithErrors)
        testCaseEl.status = 'PASSED'
      else
        testCaseEl.status = 'FAILED'
    }
    setTimeout(checkForDone, 0);
  }

  function run() {
    var resultsEl = document.createElement('div');
    resultsEl.className = 'unittest';
    document.body.appendChild(resultsEl);

    var numPassed = 0;
    var numFailures = 0;
    var runner = {
      addFailedTest: function() {
        numFailures++;
      },
      addPassedTest: function() {
        numPassed++;
      }
    };
    function begin() {
      for (var i = 0; i < tests.length; i++) {
        (function() {
          var testCaseEl = unittest.createTestCaseDiv_(tests[i]);
          resultsEl.appendChild(testCaseEl);
          runTest(runner, testCaseEl, tests[i]);
        })();
      }
    }
    begin();
  }
  document.addEventListener('DOMContentLoaded', run);
  </script>
</body>
</html>
