<!DOCTYPE HTML>
<html>
<!--
Copyright (c) 2013 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->
<head>
<title>Record Selection Dialog Tests</title>
<script src="/src/base.js"></script>
<link rel="shortcut icon" href="data:image/x-icon;base64," type="image/x-icon">
</head>
<body>
  <script>
    base.require('base.settings');
    base.require('base.unittest');
    base.require('tracing.test_utils');
    base.require('tracing.record_selection_dialog');
  </script>
  <script>
    'use strict';

    function testRecordSelectionDialog_UpdateForm_NoSettings() {
      var settings = new base.Settings();

      var dlg = new tracing.RecordSelectionDialog();
      dlg.categories = ['disabled-by-default-one', 'two', 'three'];
      dlg.settings = settings;
      dlg.settings_key = 'key';
      dlg.updateForm_();

      var checkboxes = dlg.formEl_.getElementsByTagName('input');
      assertEquals(3, checkboxes.length);
      assertEquals('three', checkboxes[0].id);
      assertEquals('three', checkboxes[0].value);
      assertEquals(true, checkboxes[0].checked);
      assertEquals('two', checkboxes[1].id);
      assertEquals('two', checkboxes[1].value);
      assertEquals(true, checkboxes[1].checked);
      assertEquals('disabled-by-default-one', checkboxes[2].id);
      assertEquals('disabled-by-default-one', checkboxes[2].value);
      assertEquals(false, checkboxes[2].checked);

      assertEquals('', dlg.categoryFilter());

      var labels = dlg.formEl_.getElementsByTagName('label');
      assertEquals(3, labels.length);
      assertEquals('three', labels[0].textContent);
      assertEquals('two', labels[1].textContent);
      assertEquals('disabled-by-default-one', labels[2].textContent);
    }

    function testRecordSelectionDialog_UpdateForm_Settings() {
      var settings = new base.Settings();
      settings.set('two', true, 'categories');
      settings.set('three', false, 'categories');

      var dlg = new tracing.RecordSelectionDialog();
      dlg.categories = ['disabled-by-default-one'];
      dlg.settings = settings;
      dlg.settings_key = 'categories';
      dlg.updateForm_();

      var checkboxes = dlg.formEl_.getElementsByTagName('input');
      assertEquals(3, checkboxes.length);
      assertEquals('three', checkboxes[0].id);
      assertEquals('three', checkboxes[0].value);
      assertEquals(false, checkboxes[0].checked);
      assertEquals('two', checkboxes[1].id);
      assertEquals('two', checkboxes[1].value);
      assertEquals(true, checkboxes[1].checked);
      assertEquals('disabled-by-default-one', checkboxes[2].id);
      assertEquals('disabled-by-default-one', checkboxes[2].value);
      assertEquals(false, checkboxes[2].checked);

      assertEquals('-three', dlg.categoryFilter());

      var labels = dlg.formEl_.getElementsByTagName('label');
      assertEquals(3, labels.length);
      assertEquals('three', labels[0].textContent);
      assertEquals('two', labels[1].textContent);
      assertEquals('disabled-by-default-one', labels[2].textContent);
    }

    function testRecordSelectionDialog_UpdateForm_DisabledByDefault() {
      var settings = new base.Settings();

      var dlg = new tracing.RecordSelectionDialog();
      dlg.categories = ['disabled-by-default-bar', 'baz'];
      dlg.settings = settings;
      dlg.settings_key = 'categories';
      dlg.updateForm_();

      assertEquals('', dlg.categoryFilter());

      var inputs =
          dlg.formEl_.querySelector('input#disabled-by-default-bar').click();

     assertEquals('disabled-by-default-bar', dlg.categoryFilter());

     assertEquals('false',
         settings.get('disabled-by-default-foo', 'false', 'categories'));
    }
  </script>
</body>
</html>
