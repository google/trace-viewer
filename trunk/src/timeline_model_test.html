<!DOCTYPE HTML>
<html>
<!--
Copyright (c) 2012 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->
<head>
<title>TimelineModel tests</title>
<script src="base.js"></script>
<style>
  .timeline-view {
    border: 1px solid black;
    margin: 10px;
  }
  .timeline-find-dialog {
    border: 1px solid black;
    margin: 10px;
  }
</style>
</head>
<body>
<script>
'use strict';

base.defineModule('timeline_model_test')
    .dependsOn('unittest',
               'test_utils',
               'timeline_model')
    .runAllTests(function() {

var tests = {};

var TimelineSlice = tracing.TimelineSlice;
var TimelineThreadSlice = tracing.TimelineThreadSlice;
var TimelineThread = tracing.TimelineThread;
var TimelineModel = tracing.TimelineModel;
var TimelineFilter = tracing.TimelineFilter;

tests.testModelBounds_EmptyModel = function() {
  var m = new TimelineModel();
  m.updateBounds();
  assertEquals(undefined, m.minTimestamp);
  assertEquals(undefined, m.maxTimestamp);
}

tests.testModelBounds_OneEmptyThread = function() {
  var m = new TimelineModel();
  var t = m.getOrCreateProcess(1).getOrCreateThread(1);
  m.updateBounds();
  assertEquals(undefined, m.minTimestamp);
  assertEquals(undefined, m.maxTimestamp);
}

tests.testModelBounds_OneThread = function() {
  var m = new TimelineModel();
  var t = m.getOrCreateProcess(1).getOrCreateThread(1);
  t.subRows[0].push(new TimelineThreadSlice('a', 0, 1, {}, 3));
  m.updateBounds();
  assertEquals(1, m.minTimestamp);
  assertEquals(4, m.maxTimestamp);
}

tests.testModelBounds_OneThreadAndOneEmptyThread = function() {
  var m = new TimelineModel();
  var t1 = m.getOrCreateProcess(1).getOrCreateThread(1);
  t1.subRows[0].push(new TimelineThreadSlice('a', 0, 1, {}, 3));
  var t2 = m.getOrCreateProcess(1).getOrCreateThread(1);
  m.updateBounds();
  assertEquals(1, m.minTimestamp);
  assertEquals(4, m.maxTimestamp);
}

tests.testModelBounds_OneCpu = function() {
  var m = new TimelineModel();
  var cpu = m.getOrCreateCpu(1);
  cpu.slices.push(new TimelineSlice('a', 0, 1, {}, 3));
  m.updateBounds();
  assertEquals(1, m.minTimestamp);
  assertEquals(4, m.maxTimestamp);
}


tests.testModelBounds_OneCpuOneThread = function() {
  var m = new TimelineModel();
  var cpu = m.getOrCreateCpu(1);
  cpu.slices.push(new TimelineSlice('a', 0, 1, {}, 3));

  var t = m.getOrCreateProcess(1).getOrCreateThread(1);
  t.subRows[0].push(new TimelineThreadSlice('a', 0, 1, {}, 4));

  m.updateBounds();
  assertEquals(1, m.minTimestamp);
  assertEquals(5, m.maxTimestamp);
}

tests.testModelCanImportEmpty = function() {
  var m;
  m = new TimelineModel([]);
  m = new TimelineModel('');
}

tests.testTimelineFilter = function() {
  var s0 = new TimelineSlice('a', 0, 1, {}, 3);
  assertFalse(new TimelineFilter('').matchSlice(s0));

  assertTrue(new TimelineFilter('a').matchSlice(s0));
  assertFalse(new TimelineFilter('x').matchSlice(s0));

  var s1 = new TimelineSlice('ba', 0, 1, {}, 3);
  assertTrue(new TimelineFilter('a').matchSlice(s1));
  assertTrue(new TimelineFilter('ba').matchSlice(s1));
  assertFalse(new TimelineFilter('x').matchSlice(s1));
}

  return tests;
});
</script>
</body>
</html>
